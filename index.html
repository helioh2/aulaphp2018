<html>
    <head>
        <title>Listar Clientes</title>        
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <script src="http://www.w3schools.com/lib/w3data.js"></script>
        <!-- <script src="./node_modules/jquery/dist/jquery.min.js"></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
        <!-- <script src="itens.js"></script> -->
    </head>
    <body ng-app="clientes" ng-controller="listarCtrl">
        <div w3-include-html="menu.html"></div> 
        <div class="container">
            <div class="panel panel-default">
                <div class="panel panel-heading">
                    <strong>Lista de Clientes</strong>
                </div>
                <h2></h2>
                <div class="panel panel-body">
                    <table id="tabClientes" class="table table-condensed table-striped">
                        
                        <thead class="text-center">
                            <th>id</th>
                            <th>nome</th>
                            <th>idade</th>
                            <th>sexo</th>
                            <th>data nascimento</th>
                            <th>email</th>
                            <th>endereco</th>
                            <th><a href='formInserir.html' class="btn btn-success    ">Inserir</a></th>
                        </thead>
                        <tbody>
                            <tr ng-repeat="x in clientes">
                                <td>{{ x.id }}</td>
                                <td>{{ x.nome }}</td>
                                <td>{{ x.idade }}</td>
                                <td>{{ x.sexo }}</td>
                                <td>{{ x.dataNascimento }}</td>
                                <td>{{ x.email }}</td>
                                <td>{{ x.endereco }}</td>
                                <td>
                                    <a href='{{clientes.deletar(x)}}' class='btn btn-danger'>Deletar</a> 
                                    <a href='formAlterar.html?id={{ x.id }}' class='btn btn-primary'>Alterar</a> 
                                </td>
                            </tr>
                        </tbody>                 

                    </table>
                </div>
            </div>
        </div>
    </body>
    <script>
        var app = angular.module('clientes', []);
        app.controller('listarCtrl', function($scope, $http) {
            $http.get("/api/clientes")
            .then(function success(response) {
                $scope.clientes = response.data
            }, function error(response) {
                window.location.replace("login.html");
            });

            $scope.deletar = function(cliente) {
                $http.delete(`/api/clientes/${cliente.id}`)
                .then(function success(response) {
                    $scope.clientes = clientes.filter(function(id) {
                        return cliente.id !== id;
                    })
                })
            }
        });
    </script>
</html>







